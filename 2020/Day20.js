let rawInput = "Tile 3457:\r\n##.###.##.\r\n...#..##.#\r\n#.#..###..\r\n##.....#..\r\n#.#....#.#\r\n...##.#...\r\n##..#....#\r\n..###..#..\r\n#........#\r\n#.##..#.#.\n\nTile 3061:\r\n##....####\r\n#.#.......\r\n#.....##..\r\n#........#\r\n.....#....\r\n##......##\r\n.##..###..\r\n........#.\r\n...#....#.\r\n..###.#.##\n\nTile 2131:\r\n.#..#..#.#\r\n#....#..##\r\n#........#\r\n#..#..#..#\r\n.#...#..#.\r\n##........\r\n##.##..###\r\n..#..##...\r\n......##.#\r\n##..######\n\nTile 2087:\r\n.##.#.....\r\n...#......\r\n###.......\r\n#.#......#\r\n##....#.#.\r\n..........\r\n........##\r\n#.....#.#.\r\n...##.#...\r\n..##.##..#\n\nTile 2593:\r\n#.###.##.#\r\n.#..#...#.\r\n.........#\r\n#..###....\r\n....##....\r\n##..#..#..\r\n###.##....\r\n#....####.\r\n.#..##..#.\r\n.#.....###\n\nTile 1277:\r\n###.#.#...\r\n..##......\r\n#..#.#...#\r\n...##.#..#\r\n#...###.#.\r\n..#......#\r\n##...#....\r\n......#.##\r\n##.#.##..#\r\n..#...#...\n\nTile 2917:\r\n###.#....#\r\n....##.###\r\n#......#.#\r\n#..#.#...#\r\n#.#....##.\r\n#..#..#.#.\r\n..#####...\r\n##.##.#.##\r\n#.#....###\r\n#####.#..#\n\nTile 1579:\r\n#.#..#..##\r\n..#....###\r\n##......#.\r\n#...#..###\r\n#..##..#..\r\n##.##....#\r\n.##....#.#\r\n#.###...#.\r\n..#.#.#.#.\r\n##.#.#....\n\nTile 3011:\r\n....#.#.#.\r\n##........\r\n#.#......#\r\n#...#..#.#\r\n........##\r\n#..#.....#\r\n.....#....\r\n#.##......\r\n#...#..#..\r\n....#..#..\n\nTile 2539:\r\n..#.#.#.##\r\n...#.#####\r\n.........#\r\n..........\r\n.....##..#\r\n##....##.#\r\n#.....#...\r\n....##.#..\r\n..#.##.#..\r\n#.#.#....#\n\nTile 1879:\r\n##.#######\r\n#..#....#.\r\n........##\r\n..#.....#.\r\n#.#.#..#..\r\n...##....#\r\n#..##..#.#\r\n..#.....#.\r\n#.....#...\r\n.#####.##.\n\nTile 2081:\r\n..#....#.#\r\n#.##.#.#.#\r\n#....#.##.\r\n##......##\r\n....#.#.##\r\n......#..#\r\n##.......#\r\n#........#\r\n..#..#...#\r\n..###..#..\n\nTile 1721:\r\n.#.####.##\r\n....#.#..#\r\n#...#.#...\r\n#...#.##..\r\n#.#.#.####\r\n#...#.#..#\r\n.........#\r\n..#..##.#.\r\n#.#.#.##.#\r\n#..#....#.\n\nTile 1237:\r\n.....###..\r\n.......#..\r\n#...#....#\r\n......#.##\r\n###....#..\r\n#.#..#.#..\r\n..#......#\r\n..#..#..#.\r\n.#........\r\n#.#.#.##..\n\nTile 3037:\r\n..#..####.\r\n........#.\r\n...#.#...#\r\n.##.##..#.\r\n#.##.#.#..\r\n#...#.#.##\r\n#..###....\r\n#......###\r\n#.#..###.#\r\n.##...#.##\n\nTile 2719:\r\n######.##.\r\n#...#...#.\r\n#..##.#..#\r\n##........\r\n..#.##....\r\n##........\r\n#.###.###.\r\n#..#....#.\r\n##..##....\r\n.#....#.#.\n\nTile 1013:\r\n.#...#.##.\r\n#..#.##...\r\n##..#....#\r\n#......#..\r\n.#..##....\r\n..#.......\r\n........##\r\n#........#\r\n.....##...\r\n#.#.###...\n\nTile 3571:\r\n.......#.#\r\n.#...#...#\r\n....##....\r\n#......#.#\r\n.###.#..#.\r\n#...##...#\r\n##...#.#..\r\n......#...\r\n#.#....#..\r\n##....#..#\n\nTile 2269:\r\n##.#.#...#\r\n..#.#.....\r\n.##.###..#\r\n.#....##.#\r\n#.#..#.###\r\n#.....#..#\r\n#.#.#....#\r\n#..##..#.#\r\n...#....##\r\n...##.#...\n\nTile 3709:\r\n##...#..##\r\n...#...#.#\r\n#..#.#....\r\n..##.####.\r\n..#...##.#\r\n...#...#.#\r\n#...#.#...\r\n.#........\r\n..........\r\n#..#.#.#.#\n\nTile 2143:\r\n#.##.#....\r\n####...##.\r\n#.###...#.\r\n....##.#.#\r\n##.##.....\r\n.......#.#\r\n####..##..\r\n.......#..\r\n#......#.#\r\n####....##\n\nTile 3677:\r\n##.###.##.\r\n.#.###..#.\r\n..##...#..\r\n..#......#\r\n##.##.....\r\n#.#.##.#..\r\n..#..#.##.\r\n##..###...\r\n#.#......#\r\n...###.###\n\nTile 2297:\r\n.........#\r\n..........\r\n........##\r\n#.#..#....\r\n##.#..###.\r\n#........#\r\n.....#..#.\r\n...#...#.#\r\n##..#.....\r\n.#.######.\n\nTile 1871:\r\n#.#.#.....\r\n#.#....#.#\r\n..#...#..#\r\n..#..##..#\r\n#.#.##....\r\n......#.##\r\n##.##.#.##\r\n#.###.####\r\n#..#....#.\r\n###.#....#\n\nTile 3449:\r\n##..#.###.\r\n.####.....\r\n#..###..#.\r\n#....#.#..\r\n#.....#..#\r\n#....#.#..\r\n#.....#..#\r\n.#..#.....\r\n#..#.#...#\r\n.####.####\n\nTile 3391:\r\n........##\r\n##.#.#.#.#\r\n...##....#\r\n..###..###\r\n.#....#..#\r\n.#....#.#.\r\n..........\r\n#...#.#.#.\r\n.....#.#.#\r\n#.#.......\n\nTile 2243:\r\n..#...##.#\r\n##...##...\r\n..#......#\r\n..#.##.#.#\r\n.#......#.\r\n#.#...##..\r\n#.....###.\r\n##..##.#.#\r\n#.#....#.#\r\n#.#..#..##\n\nTile 2153:\r\n##.###.#.#\r\n.#.#.#.#.#\r\n#..#..###.\r\n.##..#.#.#\r\n.#.....#..\r\n..#......#\r\n........##\r\n.#.....##.\r\n.#.......#\r\n#......###\n\nTile 3659:\r\n.#.#....##\r\n..#..#..#.\r\n..###...##\r\n..........\r\n#.....#..#\r\n##.#.#..##\r\n#.###..#..\r\n#..#....##\r\n#........#\r\n#.###..##.\n\nTile 2503:\r\n##..##.#.#\r\n#..#..#...\r\n.....#...#\r\n...#.....#\r\n#.....#...\r\n.....###.#\r\n#..#..#...\r\n..#...#...\r\n#..#...##.\r\n.###...###\n\nTile 2741:\r\n#..#.#####\r\n..#.......\r\n...#..##..\r\n#...#.....\r\n.#.#.#....\r\n..###..#..\r\n.#.#..#..#\r\n.##..#.##.\r\n##.#......\r\n.##....#.#\n\nTile 3371:\r\n..###.#..#\r\n#..#......\r\n###...#..#\r\n..........\r\n.#..##...#\r\n...#.....#\r\n...##.#...\r\n#.#.#..#..\r\n#.......#.\r\n###.#.###.\n\nTile 2731:\r\n#...#.#...\r\n#.#..#....\r\n#...#.#...\r\n#.###.####\r\n.#.##....#\r\n##..#....#\r\n#.#.......\r\n##..#....#\r\n......##..\r\n###...###.\n\nTile 3217:\r\n.#..#..#.#\r\n##...#...#\r\n....##..#.\r\n#...#.#...\r\n#......###\r\n##.#....##\r\n#..#...##.\r\n#...#...##\r\n#.#.#.....\r\n.#.#......\n\nTile 3911:\r\n..###..##.\r\n.....#.#..\r\n##.#...#.#\r\n#.....#..#\r\n.......#.#\r\n#........#\r\n..#....#.#\r\n#.##....##\r\n.....#...#\r\n##.##.#.#.\n\nTile 1637:\r\n.#.#..#.##\r\n##..#.#...\r\n.#.#####.#\r\n..#..#..#.\r\n#......###\r\n#.........\r\n#.##...##.\r\n#........#\r\n#..#.....#\r\n..#...#.#.\n\nTile 3989:\r\n.#..##.##.\r\n..........\r\n..#.##..##\r\n#.#..#....\r\n#...#....#\r\n#..#.#.#.#\r\n##....#..#\r\n#.#...#...\r\n######.##.\r\n.#..#..###\n\nTile 2213:\r\n...#..####\r\n.....###..\r\n##....###.\r\n#...###.##\r\n##...####.\r\n#.........\r\n......#...\r\n#.......##\r\n###.....##\r\n.##...###.\n\nTile 1061:\r\n.#.....##.\r\n#...#..#.#\r\n#.......#.\r\n.#.......#\r\n.....#....\r\n.#....#.##\r\n##.#....##\r\n#...#...#.\r\n#...#.##..\r\n.###.....#\n\nTile 2281:\r\n..#..##.#.\r\n..##.....#\r\n..##.....#\r\n..#.#....#\r\n#.#..##.#.\r\n#..#..#.##\r\n#......#..\r\n...#...#.#\r\n..##......\r\n#.###.###.\n\nTile 3803:\r\n####.##..#\r\n#..#..#.##\r\n.#...##...\r\n#..#.#.##.\r\n#...#....#\r\n....#....#\r\n..#.##.#..\r\n#..#...#..\r\n##........\r\n#...#.#...\n\nTile 3347:\r\n.##.##...#\r\n#..#.#....\r\n...##.##..\r\n#...#.....\r\n#.....##..\r\n#.#..#...#\r\n.....#.#.#\r\n#.........\r\n#.........\r\n##..#####.\n\nTile 2687:\r\n.#####.#..\r\n#.#.#.....\r\n#....#....\r\n.##.#.....\r\n#.##....##\r\n#....#...#\r\n###.##...#\r\n##..#....#\r\n....#....#\r\n#.##.#.##.\n\nTile 1097:\r\n##....#..#\r\n....##...#\r\n#...#.#...\r\n#....#....\r\n.....#..##\r\n#..##.#..#\r\n#....#....\r\n###....###\r\n#.....#.##\r\n#....#...#\n\nTile 1483:\r\n#..#.##...\r\n....##.#.#\r\n...##....#\r\n#..##..#.#\r\n.#...##...\r\n..........\r\n#..#..##..\r\n....##.#.#\r\n######....\r\n####....#.\n\nTile 2207:\r\n.#.###.##.\r\n.##..#....\r\n....#....#\r\n#....#....\r\n#....##..#\r\n#.#.....##\r\n...#....#.\r\n#.#..#...#\r\n.#.......#\r\n.#####.##.\n\nTile 1559:\r\n.####..##.\r\n##..##.#.#\r\n......##..\r\n##.#..#..#\r\n.#.#.#....\r\n#....#..#.\r\n#..#..#.#.\r\n#.#..#.#.#\r\n#...##.#..\r\n.#...#....\n\nTile 3019:\r\n...#.###.#\r\n.##..#..##\r\n...##..#..\r\n..#...##.#\r\n#......#..\r\n#....#.###\r\n##..#....#\r\n#.#....#..\r\n#..##..#.#\r\n#.#####..#\n\nTile 2441:\r\n...####.#.\r\n#..#.#...#\r\n...##.#..#\r\n#.#......#\r\n#..#.#.#..\r\n#..##....#\r\n.####.#...\r\n.#.#...#..\r\n..##..#..#\r\n.#..#.#...\n\nTile 1997:\r\n.##.###...\r\n......#..#\r\n....#.#..#\r\n..#.##...#\r\n.....##..#\r\n###.#.#...\r\n##........\r\n#.....#...\r\n##....#.##\r\n######..##\n\nTile 1481:\r\n####.#####\r\n##.#.....#\r\n#.#....#.#\r\n.......#..\r\n#........#\r\n#....##...\r\n...#..#..#\r\n.#......##\r\n....##...#\r\n.#########\n\nTile 1811:\r\n..#..#.##.\r\n.....#.#..\r\n..#...#...\r\n##.....#..\r\n.#.#.....#\r\n...#####.#\r\n#...#.##.#\r\n....#.#..#\r\n....#.#...\r\n#..#.##...\n\nTile 3701:\r\n####.###.#\r\n###.....##\r\n#...##.###\r\n....###.#.\r\n#.#.#..#.#\r\n..###....#\r\n.#...#...#\r\n#.##..#...\r\n####....##\r\n.#####..##\n\nTile 1451:\r\n###.##.#..\r\n#...##.#.#\r\n.#.......#\r\n#.....#...\r\n.#........\r\n#.......##\r\n...##.#.#.\r\n.#..##..##\r\n#.#.#.....\r\n....#....#\n\nTile 3319:\r\n....####.#\r\n.#..#...##\r\n..##.###..\r\n#...#..#.#\r\n.#........\r\n......#...\r\n........##\r\n#.....#...\r\n#.........\r\n..##.##..#\n\nTile 2659:\r\n.##..#.#..\r\n#.#...##..\r\n.####..##.\r\n.....#####\r\n##........\r\n.#........\r\n#.#.#.....\r\n.....##...\r\n........##\r\n..#.......\n\nTile 1433:\r\n#.##.##.##\r\n.#.....#..\r\n....#.#...\r\n.#..#.####\r\n....#.#..#\r\n####...#.#\r\n.#.#..#.#.\r\n..#......#\r\n.#.#.#.#..\r\n#.###.#.#.\n\nTile 1409:\r\n#..###....\r\n###.......\r\n#...#..##.\r\n#.##....##\r\n..#...#..#\r\n.#..##..##\r\n..#..#...#\r\n##..#.####\r\n#....#####\r\n##..####..\n\nTile 1747:\r\n...##.###.\r\n##...##.#.\r\n......#..#\r\n#.#.....##\r\n#..#....##\r\n###.##.#.#\r\n.......#.#\r\n#...#....#\r\n......#..#\r\n##...####.\n\nTile 2011:\r\n.#.#..##..\r\n.......###\r\n#.#.#...##\r\n#...#.###.\r\n......###.\r\n....#.#...\r\n....#.##..\r\n.##......#\r\n##....###.\r\n###.####..\n\nTile 1009:\r\n.#.#...###\r\n#.#.##..#.\r\n..........\r\n.....#...#\r\n.#...#..##\r\n.#..#.#.##\r\n#..####.##\r\n#.##.#.#.#\r\n..###....#\r\n.##..#....\n\nTile 1759:\r\n#.#######.\r\n#..#....##\r\n..........\r\n..###..#.#\r\n#..###....\r\n#.######..\r\n...##.##.#\r\n#.........\r\n##.......#\r\n#...#..###\n\nTile 1223:\r\n###..#.##.\r\n##..##....\r\n...##.....\r\n#..#.#..#.\r\n#..##.#...\r\n.#.......#\r\n...#..#.#.\r\n##.......#\r\n##........\r\n.###.#...#\n\nTile 2467:\r\n.#.##.#.#.\r\n#.........\r\n##.....#..\r\n.##...####\r\n#..#..#..#\r\n#.#...#...\r\n........#.\r\n##.......#\r\n..#....###\r\n##....#...\n\nTile 1571:\r\n...##.#.##\r\n..#.......\r\n.#.#..#..#\r\n..........\r\n#.......#.\r\n..#....#.#\r\n#.###.....\r\n...#..##.#\r\n..##.#..##\r\n####.....#\n\nTile 1931:\r\n###..#.##.\r\n##.#..##..\r\n...##.##.#\r\n........#.\r\n.####...##\r\n..........\r\n#.....#..#\r\n#.....#..#\r\n.#..###..#\r\n.......##.\n\nTile 2711:\r\n#..#.#...#\r\n#....####.\r\n.#.#..##.#\r\n#.#.#..###\r\n......##..\r\n###...##.#\r\n##..##....\r\n.....#..#.\r\n##....##.#\r\n.#...#....\n\nTile 3331:\r\n...#.#.##.\r\n.#......#.\r\n##.#.....#\r\n#..##....#\r\n.........#\r\n##....#.#.\r\n#.#......#\r\n#.......#.\r\n##......##\r\n..##..####\n\nTile 1979:\r\n..##.#.##.\r\n...#..###.\r\n......#.#.\r\n..#..#...#\r\n#.........\r\n#.........\r\n..#.#...#.\r\n#..#..####\r\n#...#....#\r\n##.######.\n\nTile 1229:\r\n##.###.###\r\n#....#.#..\r\n#....##...\r\n#.....#...\r\n#.#......#\r\n##...#....\r\n.#...###.#\r\n#..#.#..##\r\n...#.#....\r\n.##...#.##\n\nTile 1217:\r\n#..#.#....\r\n.#....#..#\r\n.#.....###\r\n..#.#....#\r\n##....#...\r\n.#...##.##\r\n.#..#.#.#.\r\n.##..##...\r\n.#....#..#\r\n.#.#.#.#.#\n\nTile 2521:\r\n.....####.\r\n#.#....#..\r\n..#..#...#\r\n..#...#...\r\n......#...\r\n#.##..#..#\r\n..#..##..#\r\n.#..#....#\r\n#..##..###\r\n#.###.##.#\n\nTile 2251:\r\n#...#..###\r\n...##.#.#.\r\n#..#..##..\r\n##........\r\n#.........\r\n......#.##\r\n##.....#..\r\n..#.#...#.\r\n###.#.....\r\n.###..#.#.\n\nTile 1093:\r\n#####.#...\r\n###.....#.\r\n#.#.###..#\r\n....##....\r\n###.....##\r\n.#......#.\r\n#.........\r\n..#.......\r\n....#.....\r\n#.#.#.#...\n\nTile 2293:\r\n##..#.##.#\r\n#...#....#\r\n#..##.....\r\n..#......#\r\n#....#....\r\n.......#..\r\n##.....###\r\n#....#....\r\n#...#..##.\r\n########..\n\nTile 1279:\r\n#.###.##..\r\n..........\r\n#...#....#\r\n.....#...#\r\n#....#####\r\n#...#.#.#.\r\n#..#..#..#\r\n.......#..\r\n#.#...##.#\r\n#####..#..\n\nTile 1213:\r\n#...##....\r\n##.#.....#\r\n#.....#...\r\n#.......#.\r\n#.........\r\n#.#.......\r\n#........#\r\n#....#....\r\n.#..#....#\r\n.##...##..\n\nTile 3851:\r\n#.#...##.#\r\n.........#\r\n#.......#.\r\n.#.#.#..#.\r\n.##.....##\r\n...##...#.\r\n#.#...#..#\r\n#.....#..#\r\n.#.#......\r\n.#.#.##..#\n\nTile 1531:\r\n..##..#...\r\n#....#....\r\n#...#.#..#\r\n....##..#.\r\n#..#..##..\r\n.##.###.##\r\n#..#####.#\r\n##.#.##...\r\n#.#.##..#.\r\n#..##.####\n\nTile 1321:\r\n#.##.....#\r\n###.#.....\r\n#.........\r\n.......#.#\r\n#...##...#\r\n.....###.#\r\n..##...#..\r\n..#.#.##.#\r\n####....##\r\n.##...##.#\n\nTile 1619:\r\n.###..####\r\n#..##....#\r\n#.....#...\r\n......#...\r\n#.......##\r\n#....#....\r\n##..#..#..\r\n....#...#.\r\n.#.....#..\r\n.#.#.##.##\n\nTile 2803:\r\n#.#.#..#..\r\n#...#..#..\r\n#####.#.#.\r\n.##....#.#\r\n......#..#\r\n##..#.#..#\r\n..#..#..#.\r\n##......##\r\n..#.##...#\r\n.#.#....##\n\nTile 2383:\r\n.####.#..#\r\n#..#..##..\r\n#..##.#..#\r\n..##...#.#\r\n##..#.##..\r\n.#........\r\n#.##..#...\r\n#......#..\r\n#...#....#\r\n##.##..#.#\n\nTile 1291:\r\n...#.#..##\r\n##.#......\r\n....#.#.##\r\n#.#.#...##\r\n.#.##.#..#\r\n##.#...#..\r\n#..#......\r\n#.#..#....\r\n#..####..#\r\n##.....###\n\nTile 1129:\r\n#.#....##.\r\n...#.#.#..\r\n.#.#.#...#\r\n.#..#....#\r\n.#.##....#\r\n........#.\r\n.##......#\r\n...#.#.#..\r\n#.....##..\r\n.###..#...\n\nTile 2857:\r\n#.#.#.####\r\n...#.....#\r\n..#.....#.\r\n###.....#.\r\n###...##.#\r\n#..#.#...#\r\n#.##.###..\r\n.####..###\r\n#.##......\r\n..#..#.###\n\nTile 2411:\r\n......##.#\r\n##..#....#\r\n#.....#..#\r\n#..#......\r\n.#...##..#\r\n#.....##..\r\n###.#..###\r\n#.#.#####.\r\n#...#.#..#\r\n.#.##.#.##\n\nTile 3923:\r\n..#####..#\r\n#...#.#...\r\n#...##.#.#\r\n....#.....\r\n..........\r\n#.##....#.\r\n.........#\r\n##.......#\r\n#...#...##\r\n###..##.##\n\nTile 3343:\r\n#..#.###.#\r\n..#...##.#\r\n..#...#...\r\n#...#.....\r\n..#.......\r\n##.#..#...\r\n...###..#.\r\n#.#.#.#..#\r\n...#..##.#\r\n#..#...##.\n\nTile 2017:\r\n.#...###..\r\n.........#\r\n.##....##.\r\n....#...##\r\n..###.....\r\n##..##..#.\r\n#..#.##..#\r\n#.#..####.\r\n##........\r\n..#.##....\n\nTile 3889:\r\n#.##.##..#\r\n.#....#.#.\r\n.##...##.#\r\n#..#.###..\r\n#..##.#...\r\n#...##.#..\r\n.#....#.##\r\n###.#.#..#\r\n#..#...#.#\r\n.#.#..##..\n\nTile 1823:\r\n....##.##.\r\n#...#...#.\r\n..#......#\r\n..........\r\n....###..#\r\n####....#.\r\n.##......#\r\n...###.###\r\n##....#...\r\n#.#.##....\n\nTile 3769:\r\n.#..#.....\r\n...#.....#\r\n#...#....#\r\n..#..##...\r\n.....#...#\r\n....#.....\r\n#...####.#\r\n#..#.##..#\r\n#..#....##\r\n#######.#.\n\nTile 1523:\r\n.#.##....#\r\n...#...#.#\r\n#.........\r\n.....##.#.\r\n##.##..#..\r\n..#.##...#\r\n#...#..##.\r\n#....#....\r\n.#.#...#..\r\n#.#.###...\n\nTile 2843:\r\n...#....#.\r\n......###.\r\n..##....##\r\n#.###.#..#\r\n#..##.#...\r\n#.##....#.\r\n.....##...\r\n.#.......#\r\n##.#..#..#\r\n#.##....#.\n\nTile 2423:\r\n#.##.#####\r\n..#.#...#.\r\n#.....#.#.\r\n#..#.....#\r\n..##..#..#\r\n##....#..#\r\n#......#.#\r\n#.#..#.##.\r\n#.....#...\r\n.##.##.#..\n\nTile 1999:\r\n.#..#.####\r\n.#.#..#...\r\n..........\r\n...#.#.#..\r\n..#....#.#\r\n##.#...#..\r\n.#..####..\r\n.....#.#.#\r\n..#..#..##\r\n##..#..#..\n\nTile 2341:\r\n#....#.#.#\r\n##.##....#\r\n#..##.#...\r\n#..#.#....\r\n...#..#.#.\r\n##..##.###\r\n#.#.....##\r\n.......#.#\r\n##.##.....\r\n....#.####\n\nTile 3359:\r\n#..###.##.\r\n#.........\r\n.####.###.\r\n#.##....#.\r\n.#..#.##..\r\n#.........\r\n.#.#.#....\r\n..#...#..#\r\n###......#\r\n...#......\n\nTile 3863:\r\n..##.##.#.\r\n#.##..#.##\r\n.###......\r\n.#.......#\r\n..##......\r\n#..##..###\r\n.##..##...\r\n....#.#...\r\n#.#.#.##.#\r\n...##..##.\n\nTile 3187:\r\n#.#.#.#...\r\n......###.\r\n#.....####\r\n..#.#...#.\r\n#....#..#.\r\n#......#..\r\n#...##..#.\r\n#........#\r\n#.##.....#\r\n.##.#...#.\n\nTile 3119:\r\n##.....##.\r\n....#....#\r\n#..#..#..#\r\n#....##..#\r\n........#.\r\n...#.#....\r\n...##..#..\r\n.....#....\r\n#.####....\r\n...#..#.##\n\nTile 1063:\r\n.#.#.#....\r\n##........\r\n#..#.##...\r\n#..#.....#\r\n....##...#\r\n.#......#.\r\n..##...##.\r\n#........#\r\n..........\r\n.#..#..#..\n\nTile 1657:\r\n.##.#.#...\r\n##.....#.#\r\n....#.#.#.\r\n#....#####\r\n###......#\r\n.#....#..#\r\n#.#..#.#..\r\n#.#.##....\r\n##.#......\r\n#..##.#...\n\nTile 3257:\r\n##.####..#\r\n#.#.#####.\r\n##.#..##..\r\n.##.#..###\r\n..#.......\r\n#...#.#..#\r\n#..#.#.#.#\r\n...#....##\r\n##.....##.\r\n...###..##\n\nTile 1987:\r\n.#.#..###.\r\n.#.......#\r\n...#....##\r\n#...##....\r\n.......#.#\r\n.#.##.####\r\n...#...#..\r\n.##...#...\r\n.........#\r\n.#.##..#..\n\nTile 1459:\r\n#.....####\r\n......#..#\r\n........#.\r\n##..#..#..\r\n###.##.#.#\r\n##..#...#.\r\n##..#.###.\r\n.##..###.#\r\n#..####...\r\n.#.#####..\n\nTile 3533:\r\n#.##...#..\r\n.#.....#..\r\n#.##......\r\n..#.....##\r\n....#..#..\r\n##..#....#\r\n#....##..#\r\n..#....#..\r\n........##\r\n.####.##.#\n\nTile 2789:\r\n..####...#\r\n#....###..\r\n#..#..##.#\r\n#.#..#....\r\n#....##...\r\n....#.....\r\n#.........\r\n#..#......\r\n.......#.#\r\n...####.#.\n\nTile 2137:\r\n#..####.##\r\n....##...#\r\n.#.....#..\r\n#.#..#####\r\n...#..#...\r\n.#.....#.#\r\n.....#..#.\r\n##..#...##\r\n..#.#.....\r\n#..######.\n\nTile 1181:\r\n.#####.#..\r\n..#.##...#\r\n#....#....\r\n#...#.#...\r\n##.......#\r\n.....#...#\r\n##..#...#.\r\n.##.##....\r\n#...##....\r\n..#.##....\n\nTile 1117:\r\n#####.####\r\n.......#..\r\n##.#..#..#\r\n#....#.#..\r\n..........\r\n..#...#.#.\r\n......#...\r\n##...#...#\r\n....#...#.\r\n#.....##..\n\nTile 3739:\r\n..####.#.#\r\n#.#.#.#...\r\n#.......##\r\n.##...#.#.\r\n#....#.#..\r\n#...#....#\r\n#.....##.#\r\n.......##.\r\n##...###.#\r\n....##..##\n\nTile 2909:\r\n.##..###..\r\n#...#.....\r\n.....#...#\r\n..##......\r\n#.##.###..\r\n##.....#.#\r\n#..#...###\r\n....##....\r\n#......#..\r\n#.#...####\n\nTile 1609:\r\n##.###.#..\r\n....#.#...\r\n#.#....##.\r\n#..##.#...\r\n.####..#.#\r\n..........\r\n##..#....#\r\n...#..#...\r\n#.........\r\n....#.###.\n\nTile 1753:\r\n....#.###.\r\n##.##.....\r\n....##....\r\n#.....##..\r\n#.##..#...\r\n..........\r\n#..#.#..#.\r\n#.....#...\r\n.#........\r\n.#.#...#.#\n\nTile 2003:\r\n#.#.####.#\r\n#.##.#...#\r\n####..#...\r\n###..##...\r\n###.......\r\n#.....#...\r\n..##......\r\n#....#..#.\r\n#.###...#.\r\n.#..#.###.\n\nTile 1399:\r\n#.#..##..#\r\n....#.##.#\r\n#..#.....#\r\n#..#....##\r\n#...#..#..\r\n#.#.#....#\r\n......##..\r\n.##.......\r\n.####.####\r\n...#...#..\n\nTile 1249:\r\n..#..####.\r\n#.##.....#\r\n..........\r\n..#.....##\r\n#.#..#...#\r\n#..#...###\r\n.....#.#.#\r\n..###..#.#\r\n.#...#..#.\r\n.#...##.#.\n\nTile 1289:\r\n#########.\r\n...#......\r\n.....##.#.\r\n...#.#...#\r\n#..#..#...\r\n#....###.#\r\n....#..#..\r\n.....##..#\r\n.....#...#\r\n.#.#####.#\n\nTile 3373:\r\n#...##..##\r\n#..#....##\r\n#..#...###\r\n#......#..\r\n..#......#\r\n.....#....\r\n#.#.......\r\n.....#.##.\r\n...#.#..##\r\n..##.##...\n\nTile 1613:\r\n####...#..\r\n#.#.......\r\n..........\r\n#....#####\r\n#..#....##\r\n...#..#...\r\n.....#...#\r\n.#......##\r\n##....#..#\r\n....#..###\n\nTile 2029:\r\n#..###.#.#\r\n#.#..#...#\r\n##...#....\r\n.#..#..#..\r\n...#...##.\r\n##.....##.\r\n..##...#.#\r\n...##.#..#\r\n#.........\r\n.#.####.##\n\nTile 2203:\r\n..####.###\r\n..##....##\r\n...##.....\r\n....#..#.#\r\n..#...#.##\r\n#.#.......\r\n...###....\r\n#.....#..#\r\n.........#\r\n.###....#.\n\nTile 1877:\r\n##.....###\r\n.....#..#.\r\n....#...#.\r\n##.#.....#\r\n.#..##...#\r\n##.#..##..\r\n..#...#...\r\n#...##....\r\n#.#.#.....\r\n.##..#....\n\nTile 3847:\r\n...##.#...\r\n.##.....##\r\n#.#.#..##.\r\n#.##..###.\r\n.........#\r\n..#...##.#\r\n#...##..##\r\n##..#.##.#\r\n#..#.....#\r\n#.##.#..#.\n\nTile 1499:\r\n..#.######\r\n#....##..#\r\n##...#...#\r\n...#.##.#.\r\n##...#...#\r\n....#....#\r\n##.....#.#\r\n#.....#...\r\n.#....#..#\r\n#.#.#..#..\n\nTile 3251:\r\n.###.#.#.#\r\n##....####\r\n##..#.....\r\n#.#....#..\r\n...#..#.##\r\n...#......\r\n#.#.##....\r\n......##..\r\n......#...\r\n..#.##...#\n\nTile 3323:\r\n...#.#....\r\n........##\r\n...#......\r\n#.......##\r\n###.##..##\r\n##.##....#\r\n...#..#...\r\n...###.###\r\n##.....#..\r\n.###.##..#\n\nTile 3109:\r\n.#.#.#.###\r\n######.#..\r\n......#...\r\n##.#.#...#\r\n.#...#..##\r\n###...#.#.\r\n....#.....\r\n#....#..##\r\n#...#.#...\r\n.#....####\n\nTile 1889:\r\n#..#.####.\r\n#..##.##..\r\n...#....##\r\n........##\r\n#.#..#####\r\n#.........\r\n#.#.#.....\r\n...###.#..\r\n#....#..#.\r\n..###.#...\n\nTile 2027:\r\n#....##...\r\n.##....#..\r\n#...#...##\r\n#........#\r\n#.....##.#\r\n.#...#..##\r\n#..#...###\r\n....#.....\r\n#..#...##.\r\n##.#.#####\n\nTile 2677:\r\n#..###.#.#\r\n##.#....#.\r\n.##.###.##\r\n#.........\r\n#........#\r\n.#.##.##.#\r\n##...##..#\r\n##......##\r\n...#......\r\n#..####...\n\nTile 1663:\r\n.####.#.#.\r\n#...#....#\r\n###....##.\r\n#..##.#.##\r\n#.....#..#\r\n.#..##....\r\n#....#.#..\r\n##........\r\n#..#......\r\n.##.##..##\n\nTile 3559:\r\n..###...#.\r\n##........\r\n..#..#..#.\r\n#.........\r\n.#.#..##.#\r\n##.#.....#\r\n..#.......\r\n#..##.#..#\r\n###.#....#\r\n.#..#..#..\n\nTile 3049:\r\n.#.##...#.\r\n#.......#.\r\n#.##....#.\r\n...#...#.#\r\n..........\r\n####..#.#.\r\n.##.##...#\r\n...#..#.#.\r\n....#....#\r\n###.#.#.#.\n\nTile 2777:\r\n..#.#..##.\r\n##..#...#.\r\n.....##...\r\n#.###...##\r\n##...#..#.\r\n.##......#\r\n....#....#\r\n##....#...\r\n##.....#..\r\n###.##...#\n\nTile 2551:\r\n#.####.##.\r\n#.........\r\n#..##...##\r\n..#......#\r\n..........\r\n##...#..##\r\n.........#\r\n#.#......#\r\n..#.....#.\r\n...#.###.#\n\nTile 3491:\r\n#.##...###\r\n#.#.#.#...\r\n#.....#..#\r\n#.....#...\r\n##..#..##.\r\n###......#\r\n#......#..\r\n....#.##.#\r\n#.##....##\r\n####.#.#.#\n\nTile 3947:\r\n#.##.#.#..\r\n....#.#.##\r\n...##....#\r\n###......#\r\n##.#..##.#\r\n..#.#..#..\r\n#....#..#.\r\n#...#....#\r\n...#..#.##\r\n###.##.#..\n\nTile 1361:\r\n..#.#.####\r\n#..#..#.##\r\n.#...#...#\r\n..........\r\n..#......#\r\n##........\r\n#.##.....#\r\n.#.......#\r\n#.#..#...#\r\n#..##...#.\n\nTile 2851:\r\n.###.##...\r\n#.....##..\r\n....##...#\r\n........#.\r\n#.#.###..#\r\n#...#.#..#\r\n##...#..##\r\n...#..#...\r\n##.......#\r\n#####.#.##\n\nTile 2381:\r\n.#.#######\r\n.#..#..##.\r\n...#......\r\n#......###\r\n#.#..#...#\r\n..###..#..\r\n...#.#.#..\r\n#......#..\r\n..##.....#\r\n..#.#.##..\n\nTile 1069:\r\n.#.#...###\r\n##..#.##.#\r\n#.#..###..\r\n###...##..\r\n.#.#....#.\r\n.........#\r\n#..#...#..\r\n..#....##.\r\n.#.#....##\r\n#.....##.#";

let tileMap = {};
rawInput.split("\n\n").forEach(r => {
    let abc = r.split("\r\n");
    tileMap[abc[0].match(/\d+/)] = abc.slice(1, abc.length);
});
let tileKeys = Object.keys(tileMap);
let maxSize = Math.sqrt(tileKeys.length)

let seaMonster = ["..................#.", "#....##....##....###", ".#..#..#..#..#..#..."];
let seaMonsterSize = seaMonster.reduce((acc, curr) => {
    return acc + curr.split("#").length-1
},0);
let seaMonsterLenght = seaMonster[0].length;
let seaMonsterRegex = [
    new RegExp(seaMonster[0]),
    new RegExp(seaMonster[1]),
    new RegExp(seaMonster[2]),
]

let possiblePositions = function (tile) {
    return [
        tile,
        rotate(tile),
        flipHorizontally(flipVertically(tile)),
        rotate(tile, false),
        flipVertically(tile),
        flipVertically(rotate(tile)),
        flipHorizontally(tile),
        flipHorizontally(rotate(tile))
    ];
}

function flipHorizontally(tile) {
    let newTile = []
    tile.forEach(t => {
        let strArr = [...t];
        strArr.reverse();
        newTile.push(strArr.join(""))
    });
    return newTile;
}
function flipVertically(tile) {
    let newTile = [];
    let i = tile.length-1;
    while (i >= 0) {
        newTile.push(tile[i]);
        i--;
    }
    return newTile;
}
function rotate(tile, right = true) {
    let newTile = [];
    if (right) {
        let i = 0;
        while (i < tile.length) {
            newTile.push(createString(tile, i, true));
            i++;
        }
    } else {
        let i = tile.length-1;
        while (i >= 0) {
            newTile.push(createString(tile, i));
            i--;
        }

    }
    return newTile;
}
function createString(tile, column, revert = false) {
    let abc = "";
    tile.forEach(t => {
        if (revert) {
            abc = t[column] + abc
        } else {
            abc += t[column]
        }
    });
    return abc;
}

let pictureIds = [];
let columnIndex = 0;
let lineIndex = 0;
while(true) {
    tileKeys.forEach(tk => {
        if (pictureIds.length === 0) {
            let mainTile = tileMap[tk];
            for (let i = 0; i < 4; i++) {
                let mainTileBorders = [mainTile[0], createString(mainTile, 0)]; //[linha, coluna]
                let foundMatches = tileKeys.some(tk2 => {
                    if (tk === tk2) return;
                    let tile2 = tileMap[tk2];
                    return possiblePositions(tile2).some(currTile => {
                        let currTileBorders = [currTile[0], createString(currTile, 0)]; //[linha, coluna]
                        return mainTileBorders[0] === currTileBorders[0] || mainTileBorders[1] === currTileBorders[1];
                    });
                });
                if (foundMatches) {
                    mainTile = rotate(mainTile);
                } else {
                    tileMap[tk] = mainTile;
                    pictureIds[0] = [tk];
                    columnIndex = 1;
                }
            }
        } else {
            if(lineIndex >= maxSize) {
                return;
            } else {
                if (columnIndex === 0 && lineIndex !== 0) {
                    let mainTileId = pictureIds[lineIndex-1][0];
                    let mainTilePic = tileMap[mainTileId];
                    let mainTileBottomBorder = mainTilePic[mainTilePic.length-1];

                    let match = tileKeys.find(tk2 => {
                        if (mainTileId === tk2) return;
                        let tile2 = tileMap[tk2];
                        return possiblePositions(tile2).find(currTile => {
                            let currTileTopBorder = currTile[0];
                            if (mainTileBottomBorder === currTileTopBorder) {
                                tileMap[tk2] = currTile;
                                return true;
                            }
                            return false;
                        });
                    });
                    pictureIds[lineIndex] = [match];
                    columnIndex++;
                } else {
                    if (columnIndex < maxSize) {
                        let mainTileId = pictureIds[lineIndex][columnIndex-1];
                        let mainTilePic = tileMap[mainTileId];
                        
                        let mainTileRightBorder = createString(mainTilePic, mainTilePic.length-1);
                        let match = tileKeys.find(tk2 => {
                            if (mainTileId === tk2) return;
                            let tile2 = tileMap[tk2];
                            return possiblePositions(tile2).find(currTile => {
                                let currTileLeftBorder = createString(currTile, 0);
                                if (mainTileRightBorder === currTileLeftBorder) {
                                    tileMap[tk2] = currTile;
                                    return true;
                                }
                                return false;
                            });
                        });
                        pictureIds[lineIndex].push(match);
                        columnIndex++;
                    } else {
                        lineIndex++;
                        columnIndex = 0;
                    }
                }
            }
        }
    });

    if (lineIndex >= maxSize) {
        console.log("Assemble the tiles into an image. What do you get if you multiply together the IDs of the four corner tiles?\nA:", pictureIds[0][0] * pictureIds[0][maxSize-1] * pictureIds[maxSize-1][0] * pictureIds[maxSize-1][maxSize-1]);
        
        let trimmedTileMap = {};
        tileKeys.forEach(k => {
            let currTile = tileMap[k];
            let trimmed = [];
            currTile.slice(1, currTile.length-1).forEach(l => {
                trimmed.push(l.slice(1, currTile.length-1));
            })
            trimmedTileMap[k] = trimmed
        });
        let fullPicture = [];
        for (let i=0;i<maxSize;i++){
            for (let j=0;j<8;j++){
                let aux = "";
                pictureIds[i].forEach(tileId => {
                    let tile = trimmedTileMap[tileId];
                    aux += tile[j];
                })
                fullPicture.push(aux);
            }
        }

        let seaMonsterCount;
        fullPicture = possiblePositions(fullPicture).find(pos => {
            seaMonsterCount = 0;
            pos.forEach((line, i) => {
                let previousLine = pos[i-1];
                let nextLine = pos[i+1];
                if (previousLine && nextLine) {
                    let charAt = 0;
                    while(charAt < line.length) {
                        let seaMonsterCandidate = [
                            previousLine.slice(charAt, charAt+seaMonsterLenght),
                            line.slice(charAt, charAt+seaMonsterLenght),
                            nextLine.slice(charAt, charAt+seaMonsterLenght),
                        ];
                        if(seaMonsterRegex[0].test(seaMonsterCandidate[0]) && seaMonsterRegex[1].test(seaMonsterCandidate[1]) && seaMonsterRegex[2].test(seaMonsterCandidate[2])) {
                            seaMonsterCount++;
                            charAt += seaMonsterLenght;
                        } else {
                            charAt++;
                        }
                    }
                }
            });
            return seaMonsterCount > 0;
        });

        console.log("How many # are not part of a sea monster?\nA:", 
            fullPicture.reduce((acc, curr) => {
                return acc + curr.split("#").length-1
            },0) - (seaMonsterCount * seaMonsterSize)
        );
        
        break;
    }
}