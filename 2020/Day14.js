let rawInput = "mask = 001X10110010XXX1011X10X0X010110011X0\r\nmem[7813] = 131\r\nmem[54447] = 69257\r\nmem[4649] = 764452\r\nmem[19188] = 31285\r\nmem[12729] = 12561\r\nmem[53924] = 61854625\r\nmem[30643] = 31622\r\nmask = X10X010101101011X011X0X1010XX0001101\r\nmem[65231] = 6306247\r\nmem[9606] = 842\r\nmem[35435] = 39105817\r\nmask = 00X010010XX01001011011111010010X10X0\r\nmem[15228] = 58105116\r\nmem[57434] = 3463765\r\nmem[65279] = 4039619\r\nmem[21972] = 185592\r\nmem[23182] = 637258\r\nmem[26506] = 21618105\r\nmem[59419] = 1185\r\nmask = 11100X1X1X1X100110X110011X1001X01100\r\nmem[41224] = 182354525\r\nmem[63664] = 11139\r\nmem[59848] = 465555194\r\nmem[7441] = 426\r\nmask = 0000X0XX100010X111101000100011010X00\r\nmem[32794] = 26498404\r\nmem[36528] = 4609841\r\nmem[52372] = 928374411\r\nmem[50746] = 13530768\r\nmask = X0X0011X01101XX1101X00X1110X00111011\r\nmem[23705] = 4702\r\nmem[53987] = 260925767\r\nmem[38759] = 107180723\r\nmem[4145] = 1388225\r\nmask = 01100X1X00111X0100XX10001X1X11X11011\r\nmem[21659] = 48254\r\nmem[47784] = 579\r\nmem[15339] = 3634\r\nmem[26981] = 17056\r\nmem[56944] = 7553\r\nmem[54362] = 25509\r\nmask = 11100011111X1X0X10010010X01X01X01100\r\nmem[36538] = 720281\r\nmem[40349] = 4553\r\nmem[38747] = 121580\r\nmem[47936] = 853\r\nmem[64464] = 14729\r\nmem[13543] = 7412\r\nmask = 0110X0X10X111001001010011001011XXXXX\r\nmem[59367] = 1805959\r\nmem[35408] = 1062861636\r\nmem[2438] = 104177\r\nmem[45204] = 49297768\r\nmask = 11110111X1X110X11111000010110X101X01\r\nmem[43520] = 50829\r\nmem[52879] = 6973\r\nmem[34130] = 1858472\r\nmem[30580] = 116283566\r\nmem[59200] = 77309650\r\nmem[39793] = 19368\r\nmem[21462] = 484824\r\nmask = 0111X001100011X11X0000001X1010XX101X\r\nmem[48944] = 713350\r\nmem[15050] = 125604\r\nmem[62553] = 4265286\r\nmem[32331] = 207\r\nmask = 00101X010X00X00110X0010X00000X010000\r\nmem[37193] = 24490589\r\nmem[47114] = 24972867\r\nmem[19137] = 85518698\r\nmem[28948] = 15755\r\nmem[63089] = 207050481\r\nmask = 0X001000XX10100X111010X011XX1000X100\r\nmem[21622] = 12726803\r\nmem[65486] = 259190646\r\nmem[9456] = 367\r\nmem[57461] = 22120\r\nmem[47219] = 461\r\nmem[42381] = 905567\r\nmask = 011XX001100011X110X0X00X001X010X0010\r\nmem[41554] = 246921\r\nmem[47818] = 12679687\r\nmem[48892] = 139693999\r\nmask = 00001X0XX01010XX11X010101100X00011XX\r\nmem[15036] = 387380\r\nmem[4946] = 2220181\r\nmem[3330] = 3484229\r\nmem[60601] = 708273\r\nmem[30390] = 22847\r\nmask = X11010110X11100X0010X00X0001X0X1100X\r\nmem[26506] = 48168688\r\nmem[39792] = 1782856\r\nmem[35767] = 30354\r\nmem[3782] = 3439\r\nmem[25399] = 804\r\nmask = X01X10X10X0X1001001X0X0100X100001100\r\nmem[36728] = 830047900\r\nmem[39236] = 454\r\nmem[35767] = 4930\r\nmask = X1XX101010XX1001101X0X0000X000001100\r\nmem[26504] = 38\r\nmem[26618] = 6509202\r\nmem[55528] = 49356209\r\nmem[39373] = 427885078\r\nmem[6797] = 35727\r\nmem[60494] = 11588408\r\nmask = 0X1000X1001X100100100000X010X01X1001\r\nmem[28964] = 3377598\r\nmem[37600] = 15038\r\nmem[54440] = 13014026\r\nmem[1872] = 54034\r\nmask = 010000101X00X0X1101000011X1000X11001\r\nmem[2672] = 38529642\r\nmem[4612] = 12358076\r\nmem[54440] = 698\r\nmem[11542] = 158875347\r\nmem[29683] = 130676\r\nmem[58914] = 13086566\r\nmask = 001XX001X100X0101X10100001100011X11X\r\nmem[61472] = 33350\r\nmem[22694] = 1012806073\r\nmem[23462] = 118427580\r\nmask = 0000100110001001XX100111110X100X0100\r\nmem[33458] = 194706\r\nmem[6488] = 4762211\r\nmem[55925] = 577\r\nmem[53312] = 691832\r\nmem[33982] = 74563572\r\nmem[54155] = 673882\r\nmem[10046] = 455259\r\nmask = 00X0X001X0001001X1100000000X1X00X00X\r\nmem[65279] = 18926\r\nmem[8787] = 404263\r\nmem[6780] = 192\r\nmem[57364] = 7578011\r\nmem[36592] = 1320217\r\nmask = 01001010X110100X10111101000X10X00110\r\nmem[10414] = 28478\r\nmem[8303] = 850886106\r\nmem[23434] = 109585\r\nmem[59687] = 55963101\r\nmem[26357] = 149399655\r\nmask = 011000010X01100100100X01000X000X1000\r\nmem[32249] = 957872254\r\nmem[37097] = 2407\r\nmem[38976] = 7487\r\nmask = 0X10000110001XXX1X100X000X10X100X010\r\nmem[59096] = 256975\r\nmem[57558] = 187691607\r\nmem[28499] = 50844685\r\nmem[21980] = 413222\r\nmem[9178] = 224473274\r\nmask = 011010XX00X010010110010000110X000100\r\nmem[28499] = 13442626\r\nmem[13668] = 767\r\nmem[65204] = 1294\r\nmem[29824] = 761\r\nmem[7353] = 107008372\r\nmask = 010010X0111X10011010110X000XXX01010X\r\nmem[31019] = 2529\r\nmem[25249] = 531972\r\nmem[7705] = 1198443\r\nmem[18755] = 1091\r\nmask = 0100101001X0100X101110010XXX01X01011\r\nmem[4011] = 170\r\nmem[55626] = 1616\r\nmem[64402] = 1736957\r\nmem[59367] = 1198\r\nmask = 00100001X01X10011110X111110110000X00\r\nmem[16640] = 927178\r\nmem[62784] = 134127\r\nmem[52017] = 209325301\r\nmem[62522] = 310138953\r\nmem[26793] = 913812410\r\nmem[13893] = 16876\r\nmask = X000X010X11X100110101000111010001X01\r\nmem[62349] = 548\r\nmem[35033] = 529\r\nmem[55681] = 98474\r\nmem[21671] = 462821\r\nmem[24184] = 15122039\r\nmask = 011000010X10100X0110100010100000X0X1\r\nmem[64651] = 19198\r\nmem[65318] = 860\r\nmem[30180] = 43025\r\nmem[33280] = 216670269\r\nmask = 0X00XX1X011010X1101110X0X0X1X0001000\r\nmem[30267] = 3237\r\nmem[28430] = 2022016\r\nmem[10792] = 19348\r\nmem[10561] = 879088\r\nmem[32331] = 1030297216\r\nmem[53667] = 1950\r\nmask = 0X1X1010100000111X1011X0X01100101010\r\nmem[3301] = 228441\r\nmem[57487] = 133621\r\nmem[64673] = 14195\r\nmem[6012] = 106013562\r\nmask = 0010X00X10011001001X0X0110X00X011X01\r\nmem[28691] = 7828\r\nmem[3272] = 5314381\r\nmem[53221] = 906\r\nmem[36257] = 483\r\nmem[39139] = 239793066\r\nmask = 011000011X0010X01X1X010X0X0X010000XX\r\nmem[6731] = 146985\r\nmem[22302] = 5265995\r\nmem[25582] = 124093\r\nmem[15205] = 160800\r\nmem[60546] = 47017168\r\nmask = 00100001100011XX1110010X0111000101X0\r\nmem[62302] = 118384\r\nmem[4442] = 943\r\nmem[32331] = 829093\r\nmem[10054] = 261101\r\nmem[21200] = 2244874\r\nmask = 000X10010000100101101X110X1001X00101\r\nmem[22694] = 160856\r\nmem[57484] = 16648378\r\nmem[11347] = 265832659\r\nmask = 0X100011001X1X01001000XX0X01X1111XX1\r\nmem[39729] = 15425\r\nmem[10968] = 43923\r\nmem[15911] = 153\r\nmask = 0001X001X00010010110010X0000010111X0\r\nmem[12587] = 58174\r\nmem[42542] = 272951779\r\nmem[4845] = 155009\r\nmem[47818] = 498\r\nmem[18721] = 12927\r\nmem[762] = 13549777\r\nmem[21972] = 1070883192\r\nmask = 0X00X0101XX0100110100001101XX0XX11X1\r\nmem[412] = 805494480\r\nmem[34671] = 511352857\r\nmem[56856] = 1382270\r\nmem[63089] = 67321554\r\nmask = 00000111011X10X11011X101X001X0001010\r\nmem[62102] = 10598387\r\nmem[47818] = 1528395\r\nmem[50481] = 4148455\r\nmask = 00X010X0111X1001101010000X101110110X\r\nmem[65185] = 729486\r\nmem[56292] = 5502033\r\nmem[12729] = 7021\r\nmask = 0X10X0010XX1100100100000100XX10X1X0X\r\nmem[37193] = 844441364\r\nmem[9631] = 725022597\r\nmem[37488] = 3522\r\nmem[53516] = 357\r\nmask = X000X110XX10101X1011100010X100000X00\r\nmem[6390] = 164431\r\nmem[8483] = 115021\r\nmem[47710] = 243784\r\nmem[49932] = 1658\r\nmem[32606] = 257364\r\nmem[41256] = 2470\r\nmask = 110X0010XX10101110X100X10X111100100X\r\nmem[40832] = 65381067\r\nmem[29277] = 994339\r\nmem[9389] = 9978911\r\nmem[21671] = 11603\r\nmask = 0100100X10101111111X00X010110111X110\r\nmem[53651] = 1911\r\nmem[35511] = 88697\r\nmem[57887] = 177165\r\nmask = 0XX0100100X01000111011X1X1X01011X1X0\r\nmem[59444] = 425\r\nmem[44821] = 7937\r\nmem[36257] = 1973535\r\nmem[40669] = 7964428\r\nmem[57733] = 16992\r\nmem[31224] = 9670413\r\nmem[54960] = 99917\r\nmask = 1111011111111001111XX1X00X011X10000X\r\nmem[52107] = 52615\r\nmem[46430] = 2797674\r\nmem[35037] = 489648\r\nmem[61728] = 5450284\r\nmask = 00101X01000010011010010XX00101000X00\r\nmem[53337] = 167323\r\nmem[23249] = 144\r\nmem[49058] = 78020\r\nmem[65279] = 34789011\r\nmem[57994] = 278\r\nmask = X0X11001X000100X1010X00100000111011X\r\nmem[24461] = 69231\r\nmem[33718] = 3112488\r\nmem[1525] = 205706\r\nmem[24842] = 6365432\r\nmem[37193] = 983\r\nmem[41010] = 1250771\r\nmem[9773] = 492\r\nmask = 000010000X10100X1110XXX00010001X0X01\r\nmem[11359] = 19286\r\nmem[15549] = 671\r\nmask = 001X000110X01X0X10101010011XX001X000\r\nmem[90] = 4165576\r\nmem[7059] = 59706\r\nmem[4845] = 197\r\nmem[35511] = 28681534\r\nmask = 1100XX101110X00X1011X0X0111100001X11\r\nmem[9839] = 7327\r\nmem[33097] = 475963031\r\nmem[47912] = 8358\r\nmem[43269] = 259178327\r\nmask = 0X1010X10X101001011X11X1101011X0X1XX\r\nmem[16654] = 8368090\r\nmem[41291] = 2146\r\nmem[20101] = 34091\r\nmem[21208] = 76242\r\nmem[35435] = 15664567\r\nmask = 00101001010010X1011011010X11010XX1X0\r\nmem[18755] = 314\r\nmem[44355] = 1709364\r\nmem[56366] = 15879386\r\nmem[23427] = 1174\r\nmem[19831] = 39454\r\nmask = X1101011001X1X01001X10111001011XX110\r\nmem[23505] = 402\r\nmem[47596] = 2233058\r\nmem[21760] = 45933\r\nmem[44370] = 27609\r\nmask = 001010010X0010XXX1101111X0X000X1X01X\r\nmem[55611] = 1454243\r\nmem[38591] = 232585\r\nmem[21621] = 231761578\r\nmem[10169] = 4045271\r\nmem[52902] = 35939890\r\nmem[60957] = 205198448\r\nmask = 01001000X0X01111X11X111100011011X11X\r\nmem[32807] = 243712052\r\nmem[45204] = 774567686\r\nmem[62717] = 171\r\nmem[55911] = 132\r\nmem[39733] = 44429\r\nmem[53259] = 79063\r\nmask = 00100001101X1X0110100X11011X0X010000\r\nmem[54912] = 65854650\r\nmem[33458] = 865332\r\nmem[40603] = 96\r\nmem[62127] = 4144\r\nmask = 00101001X00X1001XX10000X1X1X0101X000\r\nmem[37193] = 127119\r\nmem[21633] = 16917\r\nmem[36257] = 211\r\nmask = 01X010110010XXX101100X10X0010100X1X0\r\nmem[48000] = 1030\r\nmem[390] = 3489961\r\nmem[14671] = 218111318\r\nmem[55181] = 232521891\r\nmem[56447] = 5498\r\nmask = 00XX101011111001111100XX10X10111X000\r\nmem[17945] = 14147766\r\nmem[5804] = 9317\r\nmem[3243] = 76354\r\nmem[39812] = 17121\r\nmem[65185] = 882507\r\nmem[24184] = 1503364\r\nmask = 001011X10110X00X0110X0100100000X0111\r\nmem[7059] = 77105630\r\nmem[9842] = 93469\r\nmem[28235] = 46130\r\nmask = 00011001X00010010X101111101X000XX00X\r\nmem[46578] = 188558839\r\nmem[32794] = 563\r\nmem[57424] = 16073628\r\nmem[26204] = 53518555\r\nmem[21585] = 7589033\r\nmem[1209] = 174591\r\nmask = 00X11001000010X1X11XX11100100000001X\r\nmem[14670] = 552230\r\nmem[59848] = 230555109\r\nmem[52210] = 2510\r\nmem[62683] = 42631\r\nmem[34868] = 20381\r\nmem[63506] = 20704\r\nmem[13543] = 149934393\r\nmask = 0000X010X1101001111100X000X0X0XXX001\r\nmem[44146] = 9534\r\nmem[38367] = 71280\r\nmem[48566] = 39540\r\nmem[6301] = 488439556\r\nmem[16638] = 9302\r\nmem[13893] = 744336\r\nmask = 0010000X00001001X1X00001X00110XX0X01\r\nmem[7422] = 659\r\nmem[7156] = 536497\r\nmem[50861] = 75915798\r\nmask = X1X00010X11010X1101X1X101011010X10X0\r\nmem[23749] = 197897888\r\nmem[53516] = 19394\r\nmem[52597] = 327870\r\nmem[18755] = 9112\r\nmem[46245] = 256412\r\nmem[14234] = 89528\r\nmem[57220] = 95738416\r\nmask = 00X01010X000X0X1101X1101011X0111111X\r\nmem[60185] = 799555\r\nmem[33559] = 1502644\r\nmask = X11X001001101011101011100X11X1001XXX\r\nmem[38795] = 45814003\r\nmem[16914] = 10781\r\nmem[22548] = 288\r\nmask = 011001111X111X011111X0001100001XX11X\r\nmem[43238] = 115469\r\nmem[62522] = 25284\r\nmem[7798] = 116533186\r\nmem[40416] = 14162\r\nmem[15067] = 511159\r\nmem[44546] = 9872\r\nmask = 0X00X0101000100X10100X01111000001011\r\nmem[28691] = 35897352\r\nmem[13371] = 68541533\r\nmem[31458] = 6263059\r\nmem[53277] = 8235\r\nmask = 00XX100100001001011011111XXXXXX10X10\r\nmem[246] = 4365\r\nmem[63802] = 28023932\r\nmem[62691] = 38120268\r\nmem[32606] = 32155701\r\nmem[8787] = 73310772\r\nmem[6000] = 187657\r\nmem[34053] = 6302546\r\nmask = 001X001100101X01X01010001XXXXX111001\r\nmem[62717] = 2689826\r\nmem[6969] = 3812794\r\nmem[24914] = 682498819\r\nmask = 0X10X0010XX010X1011001110X100000X00X\r\nmem[29061] = 34429630\r\nmem[60199] = 3521402\r\nmem[59922] = 1653\r\nmask = 00101001000010010X100110XX10010X1001\r\nmem[47632] = 30829832\r\nmem[40349] = 2360241\r\nmask = 000011100110101X101X000X010X11001010\r\nmem[18625] = 2810\r\nmem[21671] = 6351\r\nmem[61897] = 11389\r\nmask = 011000011000X1XX101010XX00100001X000\r\nmem[32419] = 9855\r\nmem[54566] = 13281403\r\nmem[32842] = 3060651\r\nmem[52744] = 15731\r\nmask = 11X01111111110011XX1010X1X1001X101XX\r\nmem[25842] = 357864\r\nmem[55611] = 4142\r\nmem[26491] = 1993\r\nmem[14721] = 46996265\r\nmem[23074] = 163733\r\nmask = 0X000XX1X11010X1101X1010X00111000001\r\nmem[22158] = 121237\r\nmem[36592] = 656697\r\nmem[32719] = 676\r\nmem[33097] = 1034487408\r\nmem[50670] = 3906154\r\nmask = 0000001010101X01101X00010X011X1X1101\r\nmem[47329] = 918208\r\nmem[1840] = 30632603\r\nmem[59200] = 2028\r\nmem[52744] = 32\r\nmem[30837] = 1214273\r\nmem[43183] = 3866571\r\nmask = 0X10X001X000111X1010111X00100X01X1X0\r\nmem[50788] = 115928382\r\nmem[50698] = 3427485\r\nmem[4920] = 452475222\r\nmem[27354] = 14200\r\nmem[50989] = 261259\r\nmem[18721] = 159393273\r\nmask = 01X011X0011010X11X11X00110XX10001011\r\nmem[63758] = 15239\r\nmem[7707] = 2466\r\nmem[42828] = 51703347\r\nmem[56944] = 3802\r\nmem[53539] = 47276878\r\nmem[51073] = 214485441\r\nmask = 0010100X010010011110X1100X100X110110\r\nmem[15448] = 14340\r\nmem[44061] = 2031\r\nmem[19707] = 43457433\r\nmem[40603] = 21065817\r\nmem[4662] = 30053\r\nmem[38981] = 1624176\r\nmem[43872] = 10552\r\nmask = 0000X0101X1X10011X1X000X1010100101X0\r\nmem[6012] = 1491\r\nmem[45255] = 670205912\r\nmem[7096] = 2912\r\nmem[4621] = 10593101\r\nmask = 001010X01111100X10X01001X00110001100\r\nmem[40984] = 1721577\r\nmem[56292] = 31350\r\nmem[27264] = 11075225\r\nmem[13404] = 35195435\r\nmask = 0010100110011X01101001X111X0110X1001\r\nmem[27264] = 1667120\r\nmem[35927] = 155343034\r\nmem[40700] = 93937438\r\nmem[4312] = 16188010\r\nmem[25983] = 493768\r\nmask = 00101X0101X01X01011011XX1X10X100X111\r\nmem[54715] = 79942609\r\nmem[33413] = 711314\r\nmem[17167] = 667493\r\nmem[60601] = 951299\r\nmask = 0X0X10XX10001XX11X1000010X0110010011\r\nmem[6829] = 299200\r\nmem[246] = 7814\r\nmem[60199] = 134519412\r\nmem[44196] = 1696\r\nmask = X11XX111111110011X11XX00101X0111010X\r\nmem[38202] = 63903\r\nmem[6488] = 295501257\r\nmem[15959] = 196571\r\nmem[56914] = 3039159\r\nmask = 001000XX0010X0X1XX100010X1X11000010X\r\nmem[15428] = 17873557\r\nmem[46435] = 5226\r\nmem[26157] = 253038623\r\nmem[29824] = 51824195\r\nmask = 00100001X000111010100101X1X1X00X0X00\r\nmem[1886] = 20037780\r\nmem[23634] = 438988\r\nmem[53277] = 24774137\r\nmem[63775] = 1560\r\nmem[20283] = 16629883\r\nmem[43116] = 58381263\r\nmem[44729] = 272355\r\nmask = 0001X001X00010X101100101100X0001X11X\r\nmem[56960] = 1407\r\nmem[12587] = 28256\r\nmem[49069] = 54282286\r\nmem[42639] = 202261\r\nmem[11480] = 7915801\r\nmem[10095] = 517305\r\nmem[47429] = 782\r\nmask = 0X00X00100X0X00101X01111100010X1X00X\r\nmem[64530] = 2002357\r\nmem[22346] = 193156\r\nmem[412] = 6478\r\nmask = XX0X1111011010X1101X11010X1XX010000X\r\nmem[16907] = 15143671\r\nmem[4135] = 1838\r\nmask = 00101001X11011010110XX1010101X001101\r\nmem[7156] = 773\r\nmem[10128] = 2543913\r\nmem[30159] = 79295\r\nmem[26178] = 967449\r\nmask = 001010010100101X111011010001X0110X1X\r\nmem[47329] = 276882\r\nmem[24610] = 287174\r\nmem[8685] = 29977825\r\nmask = 01001XX011101X01101001XX1X100110110X\r\nmem[64033] = 250909\r\nmem[56548] = 10731345\r\nmem[39241] = 6913465\r\nmask = 01X000X011101011101110001010X100001X\r\nmem[51388] = 4106124\r\nmem[29060] = 4687691\r\nmem[27501] = 16143\r\nmem[25418] = 152\r\nmem[56360] = 3973\r\nmem[50100] = 7595264";

function applyMask(bitMask, value, version2) {
    let maskedValue = "";
    let valueIndex = value.length - 1;
    let maskIndex = 35;
    while (maskIndex >= 0) {
        if (version2) {
            if (bitMask[maskIndex] === '0') {
                maskedValue = (value[valueIndex] || '0') + maskedValue;
            } else {
                maskedValue = bitMask[maskIndex] + maskedValue;
            }
        } else {
            if (bitMask[maskIndex] === 'X') {
                maskedValue = (value[valueIndex] || '0') + maskedValue;
            } else {
                maskedValue = bitMask[maskIndex] + maskedValue;
            }
        }
        valueIndex--;
        maskIndex--;
    }

    return maskedValue;
}

function initializeDockingProgram(commands, version2 = false) {
    let memoryMap = new Map();
    let bitMask = "";
    commands.forEach(comm => {
        let values = comm.match(/(mask|mem\[(\d+)\]) = (.+)/);
        if (values[1] === "mask") {
            bitMask = values[3];
        } else {
            let memoryAddress = values[2];

            if (version2) {
                let maskedValue = applyMask(bitMask, Number(memoryAddress).toString(2), version2);
                let floatingBitCount = maskedValue.match(/X/g).length;
                
                for (let i=0;i<Math.pow(2,floatingBitCount);i++){
                    let binaryI = (i.toString(2)).padStart(floatingBitCount, '0');
                    let binaryValue = maskedValue;
                    [...binaryI].forEach(bit => {
                        binaryValue = binaryValue.replace('X', bit);
                    });
                    memoryMap.set(parseInt(binaryValue, 2), Number(values[3]));
                }
            } else {
                memoryMap.set(memoryAddress, parseInt(applyMask(bitMask, Number(values[3]).toString(2), version2), 2));
            }
        }
    });
    return [...memoryMap.values()].reduce((acc, value) => acc + value, 0);
}

let commands = rawInput.split("\r\n");
console.log("Execute the initialization program. What is the sum of all values left in memory after it completes?\nA:", initializeDockingProgram(commands));
console.log("Execute the initialization program using an emulator for a version 2 decoder chip. What is the sum of all values left in memory after it completes?\nA:",
    initializeDockingProgram(commands, true)
);

